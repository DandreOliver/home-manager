___



ğŸ”¹ Step 0: Clean up the previous failed attempts
cd ~/.config/home-manager
rm -rf result        # removes stale symlink from failed builds
rm -f ../.bashrc ../.profile  # optional, if you want to start clean


Check git status â€” you can stash or commit anything you want to keep.

ğŸ”¹ Step 1: Bootstrap Home Manager via flake

On a fresh system, you cannot rely on home-manager existing yet. You must run it via nix run the first time:

nix run github:nix-community/home-manager -- switch --flake ~/.config/home-manager#k0mrade -b backup


-b backup automatically moves any existing .bashrc / .profile to .backup

This creates the /nix/store/...-home-manager-path/bin/home-manager binary

After this step, home-manager exists and can be run normally

What to expect

Files like .bashrc and .profile may be moved to .bashrc.backup

Packages in home.packages are installed

Your dotfiles are symlinked via Home Manager

No conflicts with old profile installs

ğŸ”¹ Step 2: Verify Home Manager is installed
which home-manager
home-manager --version


Should now point to /nix/store/...-home-manager-path/bin/home-manager

If it works, you never need to bootstrap again

ğŸ”¹ Step 3: Apply your config normally

Once bootstrapped, you can run:

home-manager switch --flake ~/.config/home-manager#k0mrade


No nix run needed anymore

Config updates applied instantly

.bashrc / .profile are already managed

ğŸ”¹ Step 4: Update flake inputs

To keep nixpkgs & HM version up to date:

nix flake update
home-manager switch --flake ~/.config/home-manager#k0mrade


Updates flake.lock

Ensures reproducibility

Commit flake.lock to GitHub

ğŸ”¹ Step 5: Push everything to GitHub
git add .
git commit -m "Bootstrap flake-managed Home Manager on WSL"
git push origin main


Your repo now fully reflects all installed packages & config

ğŸ”¹ Step 6: Notes / pitfalls

Do not remove /nix-profile/bin again â€” it contains Home Manager now

Always run from Linux home, not /mnt/c/...

If you clone to a new machine, repeat Step 1 to bootstrap

âœ… TL;DR â€“ The one-command bootstrap for WSL
cd ~/.config/home-manager
rm -rf result
nix run github:nix-community/home-manager -- switch --flake .#k0mrade -b backup
home-manager switch --flake .#k0mrade


After this, home-manager exists permanently, fully flake-managed, and reproducible.

If you want, I can write a full â€œfresh WSL bootstrap + backup + push everythingâ€ script that handles .bashrc, .profile, flake updates, and commits automatically â€” literally one copy-paste command to get a new machine working.

Do you want me to do that?
____

ğŸš€ WSL + Ubuntu + Nix + Home Manager Setup
ğŸ§© Step 1 â€” Install WSL with Ubuntu

Open PowerShell as Administrator and run:

wsl --install -d Ubuntu


Then:

Launch Ubuntu from the Start Menu

Set your username

Set your password

ğŸ§ Step 2 â€” Prepare Ubuntu for Nix

Inside your fresh Ubuntu WSL:

Update the system
sudo apt update && sudo apt upgrade -y

Install required helpers if fail-sudo apt install -y curl xz-utils



âš ï¸ Do NOT install git here â€” Nix + Home Manager will manage it.

ğŸ“ Step 3 â€” Copy Your Repo into WSL

Your Windows repo lives at:

C:\Users\<you>\src\nix_wsl


Inside WSL, copy it into your Home Manager config directory:

mkdir -p ~/.config
cp -r /mnt/c/Users/<you>/src/nix_wsl ~/.config/home-manager


Verify the structure:

ls ~/.config/home-manager


You should see something like:

flake.nix
flake.lock
home.nix
git.nix
neovim.nix
...

â„ï¸ Step 4 â€” Install Nix (Multi-User + Flakes)

Inside WSL Ubuntu:

Install Nix
sh <(curl -L https://nixos.org/nix/install) --daemon

Load Nix into your current shell
. /etc/profile.d/nix.sh

Verify installation
nix --version

ğŸ”¬ Step 5 â€” Enable Flakes
mkdir -p ~/.config/nix

cat << 'EOF' > ~/.config/nix/nix.conf
experimental-features = nix-command flakes
EOF


nix profile add nixpkgs#home-manager





ğŸ— Step 6 â€” Build & Activate Home Manager (Flakes)

Navigate to your config:

cd ~/.config/home-manager

Build activation package
nix build .#homeConfigurations.k0mrade.activationPackage

Activate configuration
./result/activate

nix run github:nix-community/home-manager -- switch --flake ~/.config/home-manager#k0mrade

home-manager switch -b backup --flake .#k0mrade

âœ… What This Automatically Sets Up

Home Manager will:

Install Git

Install GitHub CLI

Install Neovim

Install LazyGit

Apply your .bashrc

Set environment variables (EDITOR, PAGER, BROWSER)

Enable Home Manager management

Everything matches your previous setup ğŸ¯

ğŸ” Step 7 â€” Verify Everything
git --version
gh --version
nvim --version
lazygit --version

echo $EDITOR
echo $BROWSER


___________________________________________________________________________________________________________________________________________
1ï¸âƒ£ Install Nix (multi-user)
sh <(curl -L https://nixos.org/nix/install) --daemon
. /etc/profile.d/nix.sh

2ï¸âƒ£ Clone your repo (on Windows or WSL, then copy to Ubuntu WSL)
# On Windows Git Bash
git clone https://github.com/DandreOliver/nix_wsl.git

# Then in WSL
mkdir -p ~/.config/home-manager
cp -r /mnt/c/Users/<YourUser>/src/nix_wsl/* ~/.config/home-manager/

3ï¸âƒ£ Activate the flake
# Go into the repo
cd ~/.config/home-manager

# Build & activate the home configuration from the flake
nix build .#homeConfigurations.k0mrade.activationPackage
./result/activate

______________________________________________________

Make sure flake.lock is up-to-date:

nix flake update


Rebuild & activate:

nix build .#homeConfigurations.k0mrade.activationPackage
./result/activate
__________________________________________________

1ï¸âƒ£ Missing dependencies (rare in flakes)

If Nix tries to build something but the binary cache doesnâ€™t have it, it may ask for curl, git, etc.

Solution: Make sure your system has basic tools installed:

sudo apt update
sudo apt install -y curl git xz-utils


These are just helpers for Nix; flakes will still manage versions inside Nix.

___________________________________________________
_________________________________________________________________________________________________________________________________________old_setup____________________________________________________________________________________________________________________________
-------------------------------------------------------------------------------home-manager switch -b backup

1ï¸âƒ£ Install Git first (outside Nix)
# Update package lists
sudo apt update

# Install Git
sudo apt install -y git curl

# Verify Git works
git --version


This makes sure Git can handle cloning your repo before Nix is installed, so Windows path quirks donâ€™t break anything.

2ï¸âƒ£ Clone your repo into the Home Manager folder
# Make the config folder
mkdir -p ~/.config

# Clone the repo directly to ~/.config/home-manager
git clone https://github.com/DandreOliver/nix_wsl.git ~/.config/home-manager

# Check that files are there
ls -la ~/.config/home-manager


âœ… At this point, you should see all your .nix files (home.nix, git.nix, etc.) without the old invalid \ file.

3ï¸âƒ£ Install Nix (multi-user recommended)
# Multi-user install
sh <(curl -L https://nixos.org/nix/install) --daemon

# Source Nix immediately
. /etc/profile.d/nix.sh

# Verify installation
nix --version

4ï¸âƒ£ Install Home Manager (via Nix)
# Switch to your Home Manager repo
cd ~/.config/home-manager

# If using flakes:
nix build .#homeConfigurations.k0mrade.activationPackage
./result/activate

# Or without flakes:
home-manager switch -b backup


This reads your modular .nix configs (home.nix imports git.nix, gh.nix, etc.) and activates them.

5ï¸âƒ£ Verify everything
# Check Git / GH / Neovim installs
git --version
gh --version
nvim --version

# Check Home Manager
home-manager status
________________________
